"use strict";function PastacEditSupplierController(e,o,l,n,r){function t(o,l,r,t){console.log("loadSupplier:",r);var c={where:{id:r}};TooltwistViews.select(s.teaContext,p,c,function(o,l,r){if(o)return void console.log("Error selecting view "+p,o);u=r,console.log("SUPPLIER_METADATA=",r),console.log("data=",l),console.log("metadata=",r),s.supplier=l.length>0?l[0]:null,s.viewLabel=r.label,s.handler?s.handler.onLoadSupplier?s.handler.onLoadSupplier(s.supplier):console.log("Not calling handler.onLoadSupplier (no handler.onLoadSupplier)"):console.log("Not calling handler.onLoadSupplier (no handler)"),s.ckeditorOptions={language:"en"},s.ckeditorOptions.toolbarGroups=[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"forms",groups:["forms"]},{name:"tools",groups:["tools"]},{name:"document",groups:["mode","document","doctools"]},{name:"others",groups:["others"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi","paragraph"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"about",groups:["about"]}],s.ckeditorOptions.removeButtons="Underline,Subscript,Superscript,Strike,Maximize,Image,Table,HorizontalRule,SpecialChar,Link,Unlink,Anchor,Scayt,PasteFromWord,PasteText,Source,Styles,Format,About,Blockquote";var t={listModel:"supplier2_list",listTableClasses:"table-condensed table-hover",listClickFunction:"supplier2_listClick",recordScope:"ctrl",recordModel:"supplier"},c=$("#supplier2_recordDiv"),d=TooltwistViews.fieldsForMode(r,"record"),g=TooltwistViews.htmlForAngular_edit(r,d,t);console.log("html=",g),c.html(g),n(c)(e);var h=$("#supplier2_contractualDiv"),d=TooltwistViews.fieldsForMode(r,"contractual"),g=TooltwistViews.htmlForAngular_edit(r,d,t);console.log("html=",g),h.html(g),n(h)(e),console.log("Set record:",s.supplier),s.headingForRecordPane=s.supplier?s.supplier.supplier_name:"",s.showProducts&&a(s.supplier.id),i(s.supplier,"logo",s.supplier.logo),i(s.supplier,"banner",s.supplier.banner),i(s.supplier,"directory_photo",s.supplier.directory_photo)})}function a(e){console.log("loadProductsForSupplier("+e+")");var o={where:{supplier_id:e}};TooltwistViews.select(s.teaContext,g,o,function(e,o,l){if(e)return void console.log("Error selecting view "+g,e);h=l,console.log("PRODUCT_METADATA=",l),console.log("data=",o),console.log("metadata=",l),s.products=o,s.products.sort(function(e,o){var l=e.name.toUpperCase(),n=o.name.toUpperCase();return l<n?-1:l>n?1:0})})}function i(e,o,l){console.log("setImagePaths(prefix:"+o+", image:"+l+")");var n="_"+o+"_thumbnail",r="_"+o+"_raw",t="_"+o+"_banner";if(l)if(l.startsWith("cloudinary:")){console.log("IS CLOUDINARY IMAGE"),null==d&&(d=cloudinary.Cloudinary.new({cloud_name:CLOUDINARY_CLOUD_NAME}));var a=l.substring("cloudinary:".length),i=a+".jpg";e[n]=d.url(i,{width:512,height:512,crop:"fit"}),e[t]=d.url(i,{width:1920,height:250,crop:"fit"}),e[r]=d.url(i),console.log("Setting "+n+" to "+e[n])}else e[n]=l,e[t]=l,e[r]=l;else e[n]="/assets/images/cleardot.png",e[t]="/assets/images/cleardot.png",e[r]="/assets/images/cleardot.png"}var s=this,c=null,d=null,p="supplier",u=null,g="product",h=null;s.teaContext={$scope:e,$http:l,$timeout:o,$compile:n,TEASERVICE_HOST:TEASERVICE_HOST,TEASERVICE_PORT:TEASERVICE_PORT,TEASERVICE_VERSION:TEASERVICE_VERSION,TEASERVICE_ACCESS_TOKEN:TEASERVICE_ACCESS_TOKEN,STORE_ID:6},s.$onInit=function(){},s.$onChanges=function(e){console.log("changed",e),s.supplierId!=c&&(console.log("SupplierId has changed"),c=s.supplierId,t(l,s.jwt,s.supplierId,null))},s.doBack=function(){s.handler&&s.handler.onBack&&s.handler.onBack()},s.doSave=function(){console.log("doSave()"),console.log("rec is ",s.supplier),TooltwistViews.save(s.teaContext,u,"record",s.supplier,function(e,o){if(console.log("save returned",e,o),e)return void console.log("Error selecting view "+p+"/record",e)}),TooltwistViews.save(s.teaContext,u,"story",s.supplier,function(e,o){if(console.log("story save returned",e,o),e)return void console.log("Error selecting view "+u+"/story",e)}),TooltwistViews.save(s.teaContext,u,"admin",s.supplier,function(e,o){if(console.log("admin save returned",e,o),e)return void console.log("Error selecting view "+p+"/admin",e)})},s.doNewProduct=function(){console.log("doNewProduct()");var e={supplier_id:s.supplier.id,name:s.newProductName,is_displayed:0,is_deleted:0};console.log("params=",e),TooltwistViews.save(s.teaContext,h,"new",e,function(e,l){if(console.log("save returned",e,l),e)return void console.log("Error selecting view "+g+"/new",e);console.log("reply is",l);var n=l.data.productId;s.newProductName="",$("#pastac-edit-supplier-add-product-modal").modal("hide"),o(function(){a(s.supplier.id),s.handler&&s.handler.onNewProduct&&s.handler.onNewProduct(n)})})},s.doSelectProduct=function(e){console.log("doSelectProduct()",e),console.log("doSelectProduct()",e.product_id),s.handler?s.handler.onSelectProduct?s.handler.onSelectProduct(e):console.log("Not calling handler.onSelectProduct (no handler.onSelectProduct)"):console.log("Not calling handler.onSelectProduct (no handler)")},s.doUploadImage=function(e,l){console.log("doUploadImage(prefix:"+l+")");var n="//"+TEASERVICE_HOST+":"+TEASERVICE_PORT+"/v3/"+TEASERVICE_APIKEY+"/supplierImage",t={image_type:l,supplier_id:e.id};console.log("URL="+n),console.log("data is ",t),console.log("file is ",a);var a=s[l+"File"];a&&(s[l+"Filesize"]=accounting.formatNumber(a.size),s[l+"Filename"]=a.name,t.file=a,r.upload({url:n,headers:{"access-token":"0613952f81da9b3d0c9e4e5fab123437",version:"2.0.0"},data:t}).then(function(n){console.log("resp: ",n);var r=n.data.publicId;console.log("Upload completed to: "+r),o(function(){switch(console.log("Uploading details."),l){case"logo":e.logo="cloudinary:"+r,i(e,"logo",e.logo),s.logoFile=null,s.handler&&s.handler.onLogoUpdate&&s.handler.onLogoUpdate(e);break;case"banner":e.banner="cloudinary:"+r,i(e,"banner",e.banner),s.bannerFile=null,s.handler&&s.handler.onBannerUpdate&&s.handler.onBannerUpdate(e);break;case"directory_photo":e.directory_photo="cloudinary:"+r,i(e,"directory_photo",e.directory_photo),s.directory_photoFile=null,s.handler&&s.handler.onDirectoryPhotoUpdate&&s.handler.onDirectoryPhotoUpdate(e);break;default:alert("Unknown image updated. prefix="+l+".")}},10)},function(e){console.log("Error status: "+e.status),s[l+"file"]=null,s[l+"Percentage"]=null,alert("Sorry, the upload failed.")},function(e){console.log("evt=",e);var n=parseInt(100*e.loaded/e.total);console.log("progress: "+n+"% "+e.config.data.file.name),o(function(){s[l+"Percentage"]=n},1)}))},s.cancelPost=function(e){s[e+"file"]=null,s[e+"Percentage"]=null},s.showProgressBar=function(e){return s[e+"File"]&&s[e+"Percentage"]&&s[e+"Percentage"]<100},s.showProcessing=function(e){return s[e+"File"]&&s[e+"Percentage"]&&100==s[e+"Percentage"]},s.doToggleIsDisplayed=function(e,o){}}angular.module("pastac-edit-supplier",[]).component("pastacEditSupplier",{controller:PastacEditSupplierController,controllerAs:"ctrl",bindings:{handler:"<",jwt:"<",supplierId:"<",showProducts:"<",backButton:"<",template:"@"},templateUrl:function(e,o){var l="/bower_components/pastac-edit-supplier/dist/pastac-edit-supplier.html";return o.template&&(l=o.template),l}});